<!DOCTYPE html>
<html>
  <head>
    <title>Parcel Sandbox</title>
    <meta charset="UTF-8" />
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src=https://lyondataviz.github.io/teaching/lyon1-m2/2021/data/matrixManagement.js></script>
  </head>

  <body>
		<div id="visu-tp4"></div>
    <script>
      // Definition de la taille du svg
      const margin = { top: 60, right: 0, bottom: 0, left: 60 },
        width = 1920,
        height = 1080;

      // ajout du svg à une 'div id="matrice"' déjà créee dans la page html
      var svg = d3
        .select("#visu-tp4")
        .append("svg")
        .attr("width", width + margin.left)
        .attr("height", height + margin.top)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")")


      AdjMatrix = d3.json("got_social_graph.json").then((json) => {
        matrix = createAdjacencyMatrix(json.nodes, json.links);
        console.log("json : ",json)
        maxWeight = d3.max(matrix, (d) => {return d.weight;})
        console.log("max : ",maxWeight)
        //console.log(matrix)
        var scale = d3.scaleQuantize().domain([0, maxWeight]).range(d3.schemeBlues[9]); // donné par D3

        matrixViz = svg.selectAll("rect")
          .data(matrix)
          .join("rect")
          .attr("width", width/json.nodes.length)
          .attr("height", height/json.nodes.length)
          .attr("x", (d) => {return d.x * width/json.nodes.length;})
	        .attr("y", (d) => {return d.y * height/json.nodes.length;})
          .style("stroke", "black")
          .style("stroke-width", ".2px")
          .style("fill", (d) => {return scale(d.weight);});


        var positionsPersonnages = d3.range(json.nodes.length);	// un tableau d'autant d'element que de personnages 
        console.log(positionsPersonnages);

        var echellexy = d3.scaleBand()
          .range([0,width])
          .domain(positionsPersonnages) 
          .paddingInner(0.1) 
          .align(0)
          .round(true);


        var labels = d3.select("svg")
          .append("g")
          .attr("transform", "translate(" + margin.top  + "," +  margin.left  + ")")
          .style("font-size","10px")
          .style("font-family", "sans-serif");

        //console.log(echellexy(5))
        maxString = d3.max(json.nodes,(d) => d.character.length)
        console.log("maxString : " + maxString)

        var rows = labels
          .append("g")
          .selectAll()
          .data(json.nodes)
          .join("text")
          .attr("transform",(d)=> {return "translate( -" + (maxString*5)  + ","+ ((d.id*height/json.nodes.length) + ((height/(json.nodes.length))/2)+2) + ")"})
          .html((d) => {return d.character;})

          
          var columns = labels
          .append("g")
          .selectAll()
          .data(json.nodes)
          .join("text")
          .attr("transform",(d)=> {return "rotate(-90) translate( " + maxString  + ","+ ((d.id*width/json.nodes.length) + ((width/(json.nodes.length))/2)+2) + ")"})
          .html((d) => {return d.character;})
          //.attr("transform", "");
          
      });
    </script>
  </body>
</html>
